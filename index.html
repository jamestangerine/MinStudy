<!DOCTYPE html>
<html lang="en">
    <head>
        <title>MinStudy</title>
        <link rel="manifest" href="manifest.webmanifest">
        <link rel="icon" href="data:,">
        <link rel="stylesheet" href="site.css">
    </head>
    <body>
        <h1>Minimal Studier</h1>
        <p>Enter a study list.</p>
        <textarea id="input" rows="8" cols="50" placeholder="term&#9;definition&#10;term&#9;definition&#10;term&#9;definition&#10;..."></textarea>
        <br><h3>Coding Separators:</h3>
        <table>
            <tr>
                <td>
                    Term-Def: <textarea id="term-def" rows="1" cols="5"></textarea>
                    <br><p class="caption">Default: Tab</p>
                </td>
                <td style="padding-left:2em">
                    Entry: <textarea id="entry" rows="1" cols="5"></textarea>
                    <br><p class="caption">Default: Newline</p>
                </td>
            </tr>
        </table>
        <br><button id="start">Begin Studying</button>
        <p style="visibility: hidden"><b style="color: #ff0000">Error:</b> <span id="error-message"></span></p>
    </body>
    <script type="module">
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js");
        }
        const input = document.getElementById("input");
        const termDef = document.getElementById("term-def");
        const entry = document.getElementById("entry");
        const error = document.getElementById("error-message");
        const errParent = error.parentElement;
        import Module from "./prog.js";
        Module().then((mod) => {
            function startClick() {
                const studyDat = input.value.split((entry.value.length > 0 ? entry.value : "\n")).map(e => e.split((termDef.value.length > 0 ? termDef.value : "\t")));
                if (studyDat.length < 3) {
                    errParent.style.visibility = "visible";
                    error.innerText = "Please enter at least 3 terms.";
                }
                else {
                    let sdl = studyDat.length;
                    for (let ct = 0; ct < sdl; ct++) {
                        let curr = studyDat[ct];
                        let cl = curr.length;
                        if (cl == 2) {
                            if (curr[0].length == 0) {
                                errParent.style.visibility = "visible";
                                error.innerText = "Entry "+(ct+1).toString()+" (\" . . . "+curr[1]+" . . . \") is missing a term. Please ensure all entries have a term.";
                                return;
                            } else if (curr[1].length == 0) {
                                errParent.style.visibility = "visible";
                                error.innerText = "Entry "+(ct+1).toString()+" (\""+curr[0]+" . . . \") is missing a definition. Please ensure all entries have a definition.";
                                return;
                            }
                        } else if (cl == 1) {
                            if (curr[0].length == 0) {
                                errParent.style.visibility = "visible";
                                error.innerText = "Entry "+(ct+1).toString()+" is empty. Please ensure all entries have a term and definition.";
                                return;
                            } else {
                                errParent.style.visibility = "visible";
                                error.innerText = "Entry "+(ct+1).toString()+" (\""+curr[0]+" . . . \") is missing a term or definition. Please ensure all entries have a term and definition.";
                                return;
                            }
                        } else {
                            if (curr[0].length == 0) {
                                errParent.style.visibility = "visible";
                                for (let i = 1; i < cl; i++) {
                                    if (curr[i].length != 0) {
                                        error.innerText = "Entry "+(ct+1).toString()+" (\" . . . "+curr[i]+" . . . \") is improperly formatted. Please ensure all entries have exactly one term and one definition.";
                                        return;
                                    }
                                }
                                error.innerText = "Entry "+(ct+1).toString()+" only contains separator characters. Please ensure all entries have exactly one term and one definition.";
                                return;
                            } else {
                                errParent.style.visibility = "visible";
                                error.innerText = "Entry "+(ct+1).toString()+" (\""+curr[0]+" . . . \") is improperly formatted. Please ensure all entries have exactly one term and one definition.";
                                return;
                            }
                        }
                    }
                    const randPtr = mod._malloc(sdl*4);
                    mod._shuffle(randPtr, sdl);
                    const resTest = HEAPU16.subarray(randPtr>>1, (randPtr>>1)+sdl);
                    console.log(resTest);
                    mod._free(randPtr);
                }
            }
            document.getElementById("start").addEventListener("click", startClick);
        });
    </script>
</html>